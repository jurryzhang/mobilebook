<!--打赏、催更、评论-->
<div class="liwu" style="text-align: center;margin-top: -30px;">
    <!--<a href="javascript:void(0)" class="cuigeng" style="margin-right:12%">
        <div style="display: inline-block">
            <img style="width:40%;" src="__STATIC__/images/liwu/cuigeng.png">
            <p>催更</p>
        </div>
    </a>-->
    <div class="cuigeng" style="display: inline-block;font-size: 14px;vertical-align: middle">
        <img style="width:30%;" src="__STATIC__/images/liwu/cuigeng.png">
        <ul style="display: inline-block;line-height: 16px;vertical-align: middle">
            <li>催更</li>
            <li style="color: #909090">{$userAction['urgeEgold']}</li>
        </ul>
    </div>
    <div class="dashang" style="display: inline-block;font-size: 14px;vertical-align: middle;">
        <img style="width:30%;" src="__STATIC__/images/liwu/dashang.png">
        <ul style="display: inline-block;line-height: 16px;vertical-align: middle;">
            <li>打赏</li>
            <li style="color: #909090">{$userAction['giftsCount']}</li>
        </ul>
    </div>
    <!-- <div class="pinglun" style="display: inline-block;font-size: 12px;vertical-align: middle;">
        <img style="width:27%;" src="__STATIC__/images/liwu/pinglun.png">
        <ul style="display: inline-block;line-height: 16px;vertical-align: middle;">
            <li>评论</li>
            <li style="color: #909090">{$userAction['giftsCount']}</li>
        </ul>
    </div> -->
</div>



<div class="read_vf_nav tborder" style=" margin-top:30px;margin-bottom:30px;">
    <!--
    <div>
        <if condition="$chapter['prechapter'] neq -1">
            <span url="{:U('Article/readChapter',array('chapter_id' => $chapter['prechapter'],'book_id' => $chapter['articleid']))}">
                上一章
            </span>
        <else/>
            <span >
                已经是第一章
            </span>
        </if>
    </div>
    <div class="catalogue">
        <span url="{:U('Article/getDirectory',array('id' => $chapter['articleid']))}">目录</span>
    </div>-->
	<if condition="$chapter['nextchapter'] neq -1">
    <a style="text-align: center; border: solid #666 1px;padding-top: 5px;margin-left: 20px;border-radius: 5px;width: 70%;" href="{:U('Article/readChapter',array('chapter_id' => $chapter['nextchapter'],'book_id' => $chapter['articleid']))}">
    <else/>
	 <a style="text-align: center; border: solid #666 1px;padding-top: 5px;margin-left: 20px;border-radius: 5px;width: 70%;" href="javascript:void(0)" onclick="alert('当前章节已经是最后一章! ')">
	 </if>
        <if condition="$chapter['nextchapter'] neq -1">
            <span url="{:U('Article/readChapter',array('chapter_id' => $chapter['nextchapter'],'book_id' => $chapter['articleid']))}">
                下一章
            </span>
        <else/>
            <span >
                已经是最后一章
            </span>
        </if>
    </a>

    <a id="menu" href="javascript:void(0)" onclick="menudisplay()" style="text-align: center;border: solid #666 1px;padding-top: 5px;margin:0 20px;border-radius: 5px;width: 15%;">
            <span >
               菜单
            </span>
    </a>
</div>
<!--菜单项-->
<div  id='menu_nav' style="display: none">

    <div class="read_vf_nav tborder" style="margin: 40px 10px 10px ;">

        <if condition="$chapter['prechapter'] neq -1">
            <a  href="{:U('Article/readChapter',array('chapter_id' => $chapter['prechapter'],'book_id' => $chapter['articleid']))}" class="read_foot_a"  >
                上一章  </a>
            <else/>
            <a  href="javascript:void(0)"  class="read_foot_a" onclick="alert('当前章节已经是第一章! ')" style="color:#999">
                上一章
            </a>
        </if>

        <a  href="{:U('Article/index',array('id' => $chapter['articleid']))}" class="read_foot_a"  >
            返回封面
            </a>
            <a href="{:U('Article/getDirectory',array('id' => $chapter['articleid']))}" class="read_foot_a"  >
                           返回目录
            </a>
            <a href="/" class="read_foot_a"  >
                           返回首页
            </a>

    </div>
    <!--
    <div class="read_vf_nav tborder" style="margin: 10px;">

        <a  class="read_foot_a"  style="">
            签到送礼
        </a>
        <a  class="read_foot_a"  style="">
            评论
        </a>
        <a  class="read_foot_a"  style="">
           打赏
        </a>
        <a  class="read_foot_a"  style="">
            书架
        </a>

    </div>
    -->
</div>

<!--点击内容—字体背景设置-->
<div class="read_set" style="display: none" >
    <li style="">
        <label >字体</label>
        <label class="set_size" onclick="fontAdd();">A+</label>
        <label class="set_size"  onclick="fontrev();">默认</label>
        <label class="set_size"  onclick="fontdef();">A—</label>
    </li>
    <li>
        <label style="color: #FFFFff">背景</label>
        <label style="background-color:#f0f0f0" class="set_color" onclick="setcolor(1);"></label>
        <label style="background-color:#C1B094" class="set_color" onclick="setcolor(2);"></label>
        <label style="background-color:#c7edcc"  class="set_color"  onclick="setcolor(3);"></label>
        <label style="background-color:#FCEDEA" class="set_color" onclick="setcolor(4);"></label>
        <label style="background-color:#E7F4FE"  class="set_color"  onclick="setcolor(5);"></label>
    </li>
</div>

<!--start 打赏-->
<div class="want_dashang" style="display: none;width: 100%;height: 100%;position: relative;">
    <div class="want_dashang_top"></div>
    <div class="want_dashang_bottom">
        <div style="width:100%;height:20%;margin-top:3%;">
            <div style="width: 10%;position: relative;left: 3%;top: 8px;">
                <a href="/index.php/User/index.html">
                    <span style="width: 20%">
                        <img src="{$userinfo.faceImg}" style="width:36px;border-radius: 18px;">
                    </span>
                </a>
            </div>
            <div style="position: relative;left:13%;top: -33px;width: 30%;">
                <a href="/index.php/User/index.html">
                    <p class="bookname" style="font-size: 13px;">
                        {$userinfo.name}
                    </p>
                    <p class="bookinfo" style="font-size: 12px;margin-top: -10px;height: 20px;color:#f89345">
                        {$userinfo.egold} 书币
                    </p>
                </a>
            </div>
            <div style="position: relative;right:-75%;top: -72px;width: 30%;text-align: center;line-height: 20px;">
				<if condition="($isweixin neq 1)">
                    <a href="{:U('Mobile/User/buyEgold')}"  style="font-size: 15px;color:#f89345;">
                        充值
                    </a>
                    <else/>
                    <a href="{:U('Mobile/User/getWeiXinInfo' ,array('backurl' => 'User-buyEgold'))}"  style="font-size: 15px;color:#f89345;">
                        充值
                    </a>
                </if>
                <!-- <a href="/User/buyEgold.html" style="font-size: 15px;color:#f89345;">充值</a> -->
            </div>
        </div>
        <div class="dashang_icon_all">
            <!-- <table>
                <tr>
                    <td class="active" data-val="10" data-type="1"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv01.png"></td>
                    <td data-val="100" data-type="2"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv02.png"></td>
                    <td data-val="500" data-type="3"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv03.png"></td>
                    <td data-val="1000" data-type="4"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv04.png"></td>
                </tr>
                <tr>
                    <td data-val="5000" data-type="5"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv05.png"></td>
                    <td data-val="10000" data-type="6"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv06.png"></td>
                    <td data-val="100000" data-type="7"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv07.png"></td>
                </tr>
            </table> -->
			<ul style="width:100%">
                <li class="active" data-val="10" data-type="1"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv01.png"></li>
                <li data-val="100" data-type="2"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv02.png"></li>
                <li data-val="500" data-type="3"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv03.png"></li>
                <li data-val="1000" data-type="4"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv04.png"></li>
                <li data-val="5000" data-type="5"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv05.png"></li>
                <li data-val="10000" data-type="6"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv06.png"></li>
                <li data-val="100000" data-type="7"><img class="dashang_icon" src="__STATIC__/images/liwu/nan-giv07.png"></li>
            </ul>
        </div>
        <div class="want_egold">
            <span style="font-size: 13px;">数量</span>
            <i class="fa fa-minus yunsuan jian"></i>
            <input type="text" value="1" name="count" readonly="readonly" style="border: none;width: 32px;text-align: center;">
            <!--<span class="count" style="text-align: center;font-size: 12px;margin:0px 3px;">1</span>-->
            <i class="fa fa-plus yunsuan jia"></i>
            <span style="font-size: 13px;margin-left: 15px">需：</span>
            <span class="egold" style="font-size: 12px;color:#f89345;">10</span>
            <span style="font-size: 12px;color: #BBB">书币</span>
            <a href="javascript:void(0);" class="zengsong"
               data-uid="{$userinfo.uid}" data-articleid="{$chapter.articleid}" data-chapterid="{$chapter.chapterid}" date-egold="{$userinfo.egold}">
                赠送
            </a>
        </div>
    </div>
</div>
<!--end 打赏-->

<!--start 催更-->
<div class="want_cuigeng" style="display: none;width: 100%;height: 100%;position: relative;">
    <div class="want_cuigeng_top"></div>
    <div class="want_cuigeng_bottom">
        <div style="width:100%;height:20%;margin-top:3%;">
            <div style="width: 10%;position: relative;left: 3%;top: 8px;">
                <a href="/User/index.html">
                    <span style="width: 20%">
                        <img src="{$userinfo.faceImg}" style="width:36px;border-radius: 18px;">
                    </span>
                </a>
            </div>
            <div style="position: relative;left:13%;top: -33px;width: 30%;">
                <a href="/User/index.html">
                    <p class="bookname" style="font-size: 13px;">
                        {$userinfo.name}
                    </p>
                    <p class="bookinfo" style="font-size: 12px;margin-top: -10px;height: 20px;color:#f89345">
                        {$userinfo.egold} 书币
                    </p>
                </a>
            </div>
            <div style="position: relative;right:-75%;top: -72px;width: 30%;text-align: center;line-height: 20px;">
				<if condition="($isweixin neq 1)">
                    <a href="{:U('Mobile/User/buyEgold')}"  style="font-size: 15px;color:#f89345;">
                        充值
                    </a>
                    <else/>
                    <a href="{:U('Mobile/User/getWeiXinInfo' ,array('backurl' => 'User-buyEgold'))}"  style="font-size: 15px;color:#f89345;">
                        充值
                    </a>
                </if>
                <!-- <a href="/User/buyEgold.html" style="font-size: 15px;color:#f89345;">充值</a> -->
            </div>
        </div>
        <div class="cuigeng_icon_all">
            <!-- <table>
                <tr>
                    <td class="activeC" data-val="300" data-size="3000"><ul><li>3千字</li><li>更新</li></ul></td>
                    <td data-val="600" data-size="6000"><ul><li>6千字</li><li>更新</li></ul></td>
                    <td data-val="900" data-size="9000"><ul><li>9千字</li><li>更新</li></ul></td>
                </tr>
                <tr>
                    <td data-val="1200" data-size="12000"><ul><li>1.2万字</li><li>更新</li></ul></td>
                    <td data-val="1500" data-size="15000"><ul><li>1.5万字</li><li>更新</li></ul></td>
                    <td data-val="1800" data-size="18000"><ul><li>1.8万字</li><li>更新</li></ul></td>
                </tr>
            </table> -->
			<ul class="cuiUl">
                <li class="activeC" data-val="300" data-size="3000"><ul><li>3千字</li><li>更新</li></ul></li>
                <li data-val="600" data-size="6000"><ul><li>6千字</li><li>更新</li></ul></li>
                <li data-val="900" data-size="9000"><ul><li>9千字</li><li>更新</li></ul></li>
                <li data-val="1200" data-size="12000"><ul><li>1.2万字</li><li>更新</li></ul></li>
                <li data-val="1500" data-size="15000"><ul><li>1.5万字</li><li>更新</li></ul></li>
                <li data-val="1800" data-size="18000"><ul><li>1.8万字</li><li>更新</li></ul></li>
            </ul>
        </div>
        <div class="want_cui_egold">
            <span style="font-size: 13px;">请输入催更金额：
                <input type="text" value="300" name="cui_egold" style="border: none;width: 140px;color: #f89345;">
                <p style="font-size: 12px;color: #CCC;margin-top:-10px">(书币;不小于100的整数)</p>
            </span>
            <a href="javascript:void(0);" class="cuigeng-btn"
               data-uid="{$userinfo.uid}" data-articleid="{$chapter.articleid}" data-chapterid="{$chapter.chapterid}" date-egold="{$userinfo.egold}">
                催更
            </a>
        </div>
    </div>
</div>
<!--end 催更-->





<script>
    $(".read_vf_nav div span").click(function () {
        if(typeof($(this).attr("url"))=="undefined")
        {
        }
        else
        {
            window.location.replace($(this).attr("url"));
        }
    })

    var flag=false;
    function menudisplay(){
        flag=!flag;
        console.log(flag);
        if(flag){
            $('#menu_nav').css("display","block");
            var h = $(document).height()-$(window).height();
            $(document).scrollTop(h);
        }else{
            $('#menu_nav').css("display","none");
        }
    }

    //弹出设置菜单
    $(".chapter_content").click(
        function () {
            $(".read_set").slideToggle('fast');
        }
    );

    var _content = $("[data-act=read_content]");
    var _change=4;

    //设置字体加
    function fontAdd() {
        var _cont_size = $("[data-act=read_content]").children("p:first").css("font-size");
        var _cont_marg = $("[data-act=read_content]").children("p:first").css("margin");
        var _last_size = parseInt(_cont_size)+_change;
        var _chan_marg = parseInt(_cont_marg)+_change;
        console.log(_cont_size,_cont_marg);
        if (_last_size>=36) {
            _last_size = 36;
            _chan_marg = 20;
        }
        setFontsize(_last_size,_chan_marg);
    }

    //设置字体减
    function fontdef() {
        var _cont_size = $("[data-act=read_content]").children("p:first").css("font-size");
        var _cont_marg = $("[data-act=read_content]").children("p:first").css("margin");
        var _last_size = parseInt(_cont_size)-_change;
        var _chan_marg = parseInt(_cont_marg)-_change;
        if (_last_size<=12){
            _last_size=12;
            _chan_marg=6;
        }

        setFontsize(_last_size,_chan_marg);

    }


    //设置默认字体
    function fontrev () {
        _last_size=16;
        _chan_marg=6;
        setFontsize(_last_size,_chan_marg);

    }


    //设置字体
    function setFontsize(_last_size,_chan_marg) {
        console.log(_last_size,_chan_marg);
        var _last_lh = _last_size + _change*2;
        _content.children("p").css({"font-size":_last_size + "px","line-height":_last_lh + "px","margin":_chan_marg + "px 0"});
        var _read_str = '{\"fs\":\"'+_last_size + '\",\"lh\":\"'+_last_lh + '\",\"pm\":\"' +_chan_marg + '\"}';
        $.cookie('shuhai_read_fs',_read_str,{expires:30,path:"/"});

    }

    //设置背景色
    function setcolor(num){
       // var _color={"bodybg":"url(/Template/mobile/default/Static/images/readbg_0"+num+".jpg)","nightcolor":"#333","conn":"#353434","conan":"#ffffff"};
       var bgcolor=["#ffffff","#f0f0f0", "#C1B094", "#c7edcc", "#FCEDEA", "#E7F4FE"];
       var _color={"bodybg":bgcolor[num],"nightcolor":"#333","conn":"#353434","conan":"#ffffff"};

        $("body").css("background",_color.bodybg);
        $(".read_vf_nav").css("background",_color.bodybg);
        $(".chapter_content p").css("color",_color.nightcolor);
        $(".read_vf_nav a").css("color",_color.nightcolor);
        _read_str = '{\"bodybg\":\"'+_color.bodybg + '\",\"con\":\"'+_color.con + '\",\"conan\":\"'+_color.cona + '\",\"mode\":\"day\",\"fontColor\":\"'+_color.nightcolor + '\"}';
        $.cookie('shuhai_read_mod',_read_str,{expires:30,path:"/"});
    }

    /*************************daidai*****************************/
	var isweixin={$isweixin};
	
    /*****设置打赏弹出框*****/
    $('.dashang').click(function(){
        $('.want_dashang').fadeIn('fast');
    });
    $('.want_dashang_top').click(function(){
        $('.want_dashang').fadeOut('fast');
    });

    /*点击打赏图标*/
    /*$('.dashang_icon_all td').click(function(){
        $(this).parents('table').find('td').removeClass('active');
        $(this).addClass('active');*/
	function getyuansuan(_this){
        var _tdVal=parseInt(_this.attr('data-val'));

        /*点击加减控制书币值*/
        var countBoj=$('input[name=count]');
        var _count=parseInt(countBoj.val());
        var _egold=_tdVal*_count;
        $('.egold').html(_egold);

        $('.want_egold .jian').click(function(e){
            e.preventDefault();
            _count=_count-1;
            _egold=_tdVal*_count;
            if(_count<=0){
                _count=1;
                _egold=_tdVal;
            }
            countBoj.val(_count);
            $('.egold').html(_egold);
        });

        $('.want_egold .jia').click(function(e){
            e.preventDefault();
            _count=_count+1;
            _egold=_tdVal*_count;
            countBoj.val(_count);
            $('.egold').html(_egold);
        });
    }
    getyuansuan($('.dashang_icon_all li'));
	$('.dashang_icon_all li').click(function(){
        $(this).addClass('active').siblings().removeClass('active');
        getyuansuan($(this));
    });

    /*打赏_赠送btn*/
    $('.zengsong').click(function(){
        var uid=$(this).attr('data-uid');
        var articleid=$(this).attr('data-articleid');
        var chapterid=$(this).attr('data-chapterid');
        var giftstype=$('li[class=active]').attr('data-type');
        var count=$('input[name=count]').val();
        var needegold=$('.egold').html();
        
        $.ajax(
            {
                type    : "POST",
                url     : "/index.php?m=Mobile&c=Gifts&a=index",
                data    : {uid:uid,articleid:articleid,chapterid:chapterid,giftstype:giftstype,count:count,needegold:needegold} ,
                success : function(data)
                {
					$('.want_dashang').fadeOut('fast');
                    successLater(data);
                }
            });
    });

    /*****设置催更弹出框*****/
    $('.cuigeng').click(function(){
        $('.want_cuigeng').fadeIn('fast');
    });
    $('.want_cuigeng_top').click(function(){
        $('.want_cuigeng').fadeOut('fast');
    });
    /*$('.cuigeng_icon_all table tr td').click(function(){
        $(this).parents('table').find('td').removeClass('activeC');
        $(this).addClass('activeC');*/
	$('.cuigeng_icon_all .cuiUl>li').click(function(){        
        $(this).addClass('activeC').siblings().removeClass('activeC');
		
        var _tdVal=parseInt($(this).attr('data-val'));

        $('input[name=cui_egold]').val(_tdVal);
    });
    /*催更*/
    $('.cuigeng-btn').click(function(){
        var uid=$(this).attr('data-uid');
        var articleid=$(this).attr('data-articleid');
        var chapterid=$(this).attr('data-chapterid');
        var wordsize=$('li[class=activeC]').attr('data-size');
        var needegold=$('input[name=cui_egold]').val();
        
        if(needegold<100){
            layer.open({
                content: '催更金额不得少于100'
                ,skin: 'msg'
                ,time: 1 //2秒后自动关闭
                ,end:function(){
                    location.reload();
                }
            });
            return false;
        }
        $.ajax(
            {
                type    : "POST",
                url     : "/index.php?m=Mobile&c=Gifts&a=urgeUpdate",
                data    : {uid:uid,articleid:articleid,chapterid:chapterid,wordsize:wordsize,needegold:needegold} ,
                success : function(data)
                {
					$('.want_cuigeng').fadeOut('fast');
                    successLater(data);
                }
            });
    });
	function successLater(data){
        layer.open({
            content: data.message
            ,skin: 'msg'
            ,time: 1 //2秒后自动关闭
            ,end:function(){
                if(data.status==-1){
                    if(isweixin){
                        $(location).attr('href', "{:U('Mobile/User/getWeiXinInfo' ,array('backurl' => 'User-buyEgold'))}");
                        /*location.href("{:U('Mobile/User/getWeiXinInfo' ,array('backurl' => 'User-buyEgold'))}");*/
                    }else{
                        $(location).attr('href', "{:U('Mobile/User/buyEgold')}");
                        /*location.href("{:U('Mobile/User/buyEgold')}");*/
                    }
                }else{
                    location.reload();
                }
            }
        });
    }
</script>